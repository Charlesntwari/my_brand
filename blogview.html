<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>User | Blog view</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="blogview.css" type="text/css" />
    <script
      src="https://kit.fontawesome.com/3318aa34ff.js"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
  </head>
  <body>
    <div id="view">
      <div class="container" id="container"></div>
      <form>
        <textarea
          name="comment"
          placeholder="comment"
          id="commentid"
        ></textarea>
        <button class="btn3">send</button>
      </form>
    </div>
    <div id="comment" class="com"></div>

    <script>
      const token = localStorage.getItem("token");
      const userType = localStorage.getItem("userType");
      window.addEventListener("DOMContentLoaded", () => {
        if (!token && userType != "visitor") {
          location.replace("./login.html");
        }
      });
      const id = new URLSearchParams(window.location.search).get("id");
      const container = document.querySelector("#container");
      const getOneById = async () => {
        const url = await fetch(" http://localhost:8000/blogs/" + id);
        const res = await url.json();
        const temp = `<div class="view">
              <img src="${res.data.image}" />
              <div class="layer">
                <h3>${res.data.title}</h3>
                <p>${res.data.body}</p>
              </div>
              <i class="fa-solid fa-heart"></i>
              <i class="fa-solid fa-comment"></i>
            </div>
            `;
        const containe = document.querySelector("#comment");
        let tempu = "";
        res.data.comments.forEach((element) => {
          tempu += `<div>
          <p>${element.comment}</p>
          </div>
            `;
        });
        containe.innerHTML = tempu;
        container.innerHTML = temp;
      };
      window.addEventListener("DOMContentLoaded", () => getOneById());
    </script>
    <!-- getting comment -->
    <script>
      window.addEventListener("DOMContentLoaded", () => getComment());
    </script>
    <!-- create comment -->
    <script>
      const form = document.querySelector("form");
      const createPost = async (e) => {
        e.preventDefault();
        form.reset();
        const doc = {
          user_id: localStorage.getItem("userId"),
          comment: form.commentid.value,
          postedDate: "23/02/2022",
        };
        await fetch("http://localhost:8000/blogs/" + id + "/comment", {
          method: "POST",
          body: JSON.stringify(doc),
          headers: { "Content-Type": "application/json" },
        });
        //  window.location.replace('/blogview.html');
      };
      form.addEventListener("submit", createPost);
    </script>
  </body>
</html>
